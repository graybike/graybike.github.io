<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
    <meta content='Gray Bike is a small software consultancy based in San Francisco, California.' name='description'>
    <meta content='software development, software engineering, engineering, design, consultancy, software consultancy, consulting, freelance, software developers, rails, d3, data visualization, data viz' name='keywords'>
    <meta content='width=device-width, initial-scale=1.0' name='viewport'>
    <meta content='mGFqkZIpRsu-KTICkZB_Lk453ig5zwNKhB2WrqWtqTg' name='google-site-verification'>
    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Git Workflow For Small Teams</title>
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700' rel='stylesheet' type='text/css'>
    <link href="../../stylesheets/all.css" rel="stylesheet" type="text/css" />
    <script src="../../javascripts/all.js" type="text/javascript"></script>
    <script src='https://use.typekit.net/wqk5aml.js'></script>
    <script>
      try{Typekit.load({ async: true });}catch(e){}
    </script>
  </head>
  <body class='words words_2016-01-11-git-workflow-for-small-teams words_2016-01-11-git-workflow-for-small-teams_index'>
    <header>
      <div>
        <h2>
          <a href='/'>
            <span class='dg'>GRAY</span>BIKE
          </a>
        </h2>
      </div>
      <nav>
        <a href='/'>
          <span>About</span>
        </a>
        <a href='/work'>
          <span>Work</span>
        </a>
        <a href='/words'>
          <span class='active'>Words</span>
        </a>
      </nav>
    </header>
    <section class='blog'>
      <article class='post type-system-slab'>
        <!-- - if current_article.data.type -->
        <!-- %p.type= current_article.data.type -->
        <p class='date'>
          Jan 11, 2016
        </p>
        <h1>
          <a href="/words/2016-01-11-git-workflow-for-small-teams/">Git Workflow For Small Teams</a>
        </h1>
        <h2>
          A Git workflow proposal for small teams of developers.
        </h2>
        <p>I recently worked with a client to develop a Git workflow for their small team of developers. Their requirements were:</p>
        
        <ul>
        <li>Continuous integration/automated deployment to staging/production</li>
        <li>Automated testing</li>
        <li>Code reviews</li>
        <li>Easy ways to revert releases</li>
        <li>Keep a history of discussions around</li>
        </ul>
        
        <p>There&rsquo;s already a <a href="http://nvie.com/posts/a-successful-git-branching-model/">really great article</a> out there that hits on many of these points. This post borrows heavily from ideas presented in that post. It also borrows a few ideas from thoughtbot&rsquo;s <a href="https://github.com/thoughtbot/guides/blob/master/protocol/git/README.md">Git Protocol</a>.</p>
        
        <p>This workflow is based on a agile sprint model, where there will be (bi-)weekly releases to production with a number of features that have been completed &amp; acceptance tested during the sprint.</p>
        
        <h3>The Tools</h3>
        
        <ul>
        <li><a href="http://github.com"><strong>Github</strong></a>: for repository hosting &amp; code review.</li>
        <li><a href="https://circleci.com/"><strong>CircleCI</strong></a>: for continuous integration. It integrates seamlessly with Github and is free for up to one container.</li>
        <li><a href="https://www.heroku.com/"><strong>Heroku</strong></a>: for web hosting. CircleCI &amp; Github both integrate well with Heroku.</li>
        </ul>
        
        <h3>The Setup</h3>
        
        <p>There are two main branches in the repository:</p>
        
        <ul>
        <li><code>master</code></li>
        <li><code>development</code></li>
        </ul>
        
        <p>The <code>master</code> branch will always reflect what&rsquo;s on production. No exceptions. Pushing to the <code>master</code> branch will trigger a deploy directly to production. <em>Because of this, you better be damn sure you&rsquo;re ready to push live before you merge to <code>master</code></em>.</p>
        
        <p>All completed features will be submitted to the <code>development</code> branch via pull requests. It will auto-deploy to the staging server.</p>
        
        <h3>Create a Feature or Bug Fix</h3>
        
        <p>Branch off: <code>development</code><br>
        Merge Into: <code>development</code><br>
        Naming Convention: <code>&lt;initials&gt;-&lt;branch name&gt;</code></p>
        
        <p>For non-urgent features or bug fixes, branch off the <code>development</code> branch and create a feature or bug fix branch:</p>
        <pre class="highlight plaintext"><code>git checkout development&#x000A;git pull&#x000A;git checkout -b &lt;initials&gt;-&lt;branch name&gt;&#x000A;</code></pre>
        
        <p>From within your feature branch, rebase regularly to incorporate the latest changes from <code>development</code>:</p>
        <pre class="highlight plaintext"><code>git fetch origin&#x000A;git rebase origin/development&#x000A;</code></pre>
        
        <p>Resolve conflicts &amp; create commits as you go along. </p>
        
        <p>When your feature is ready for merging into <code>development</code>, <a href="https://help.github.com/articles/about-git-rebase/">use <code>git rebase</code> interactively</a> to squash all your commits into one. See the &ldquo;Squashing Commits&rdquo; section for more detail.</p>
        
        <p>Share your branch.</p>
        <pre class="highlight plaintext"><code>git push origin &lt;initials&gt;-&lt;branch name&gt;&#x000A;</code></pre>
        
        <p><a href="https://help.github.com/articles/using-pull-requests/">Create a pull request</a> from this branch and request a code review. <em>Make sure you create a PR that merges into the <code>development</code> branch, not the <code>master</code> branch</em>.</p>
        
        <p><em>Your PR should merge INTO <code>development</code> FROM your feature branch.</em></p>
        
        <h4>Squashing Commits</h4>
        
        <p>Squashing commits is good for many reasons: </p>
        
        <ul>
        <li>allows you to create better commit messages </li>
        <li>rids your history of commits like &ldquo;fix whitespace&rdquo;</li>
        <li>makes it easy for reviewers to see what changes you&rsquo;ve made in one go</li>
        <li>makes it easier to <code>bisect</code> the Git history when debugging</li>
        </ul>
        
        <p>First, update your branch with the latest.</p>
        <pre class="highlight plaintext"><code>git fetch origin&#x000A;git rebase origin/master&#x000A;</code></pre>
        
        <p>Then, count the number of commits in your branch. If your branch has 3 commits, do the following:</p>
        <pre class="highlight plaintext"><code>git rebase --interactive HEAD~3&#x000A;</code></pre>
        
        <p>This will open up an editor with only the 3 last commits from the Git history, leaving the rest of the commit history alone. It&rsquo;ll probably look something like this (actual commits from the history of this post):</p>
        <pre class="highlight plaintext"><code>pick 93accac fixing grammar&#x000A;pick e054794 adjust spacing on code&#x000A;pick c344407 consistent URL formatting&#x000A;</code></pre>
        
        <p><code>reword</code> &amp; <code>squash</code> the commits into a logical, easy to understand progression. Ideally you&rsquo;ll squash them into one, but more than one is acceptable if it&rsquo;s a really large feature. The goal here is to make things easy for the person reviewing your code.</p>
        
        <h3>Merging in a feature</h3>
        
        <p>Once your code has been reviewed, fix any issues in your branch. Once again, squash commits into one. When your branch is ready, <a href="https://developer.atlassian.com/blog/2015/04/force-with-lease/">force push using <code>--force-with-lease</code></a> to make sure you&rsquo;re not overwriting anyone else&rsquo;s code.</p>
        <pre class="highlight plaintext"><code>git push --force-with-lease origin &lt;initials&gt;-&lt;branch name&gt;&#x000A;</code></pre>
        
        <p>Merge the feature branch into <code>development</code>.</p>
        <pre class="highlight plaintext"><code>git checkout development&#x000A;git merge --ff-only &lt;initials&gt;-&lt;branch name&gt;&#x000A;</code></pre>
        
        <p>Once this is done, delete your branch.</p>
        <pre class="highlight plaintext"><code>git push origin --delete &lt;initials&gt;-&lt;branch name&gt;&#x000A;git branch --delete &lt;initials&gt;-&lt;branch name&gt;&#x000A;</code></pre>
        
        <h4>A Note on Fast Forward</h4>
        
        <p>Why use <code>--ff-only</code>? <a href="https://sandofsky.com/blog/git-workflow.html">Benjamin Sandofsky recommends</a> not using <code>--no-ff</code>:</p>
        
        <blockquote>
        <p>So you add a new rule: “When you merge in your feature branch, use <code>–-no-ff</code> to force a new commit.” This gets the job done, and you move on. […]</p>
        
        <p>The <code>--no-ff</code> band-aid, broken <code>bisect</code>, and <code>blame</code> mysteries are all symptoms that you’re using a screwdriver as a hammer. […]</p>
        </blockquote>
        
        <p>Ben put together a <a href="https://sandofsky.com/images/fast_forward.pdf">great diagram</a> to visualize this. In a nutshell, <code>--no-ff</code> is really only useful when you&rsquo;re merging in multiple commits from a branch. Since we&rsquo;re squashing branch commit histories into one logical commit, using <code>--ff-only</code> works well. It will force the merge to explicitly fast forward, and will error out if it encounters issues.</p>
        
        <h3>Release</h3>
        
        <p>The <code>development</code> branch is now full of tested features that are ready for deployment. To release, create a pull request that will be merging the <code>development</code> branch into the <code>master</code> branch.</p>
        
        <p><em>Your PR should merge INTO <code>master</code> FROM <code>development</code>.</em></p>
        
        <p>Set the title of the PR to be:</p>
        <pre class="highlight plaintext"><code>YYYY-MM-DD Release&#x000A;</code></pre>
        
        <p>In the description of the PR, you can add details like:</p>
        
        <ul>
        <li>Features in the PR</li>
        <li>Trello/Asana Cards</li>
        <li>Airbrake/Honeybadger Notifications</li>
        </ul>
        
        <p>This can act as the weekly release report. Once the report is complete, you can hit the &ldquo;Merge Pull Request&rdquo; button. Once merged, the release will be auto-deployed to production. </p>
        
        <h3>Hotfixes: Urgent Production Issues</h3>
        
        <p>Branch off: <code>master</code><br>
        Merge Into: <code>master</code> and <code>development</code><br>
        Naming Convention: <code>&lt;initials&gt;-hotfix-&lt;branch name&gt;</code>  </p>
        
        <p>For issues that cannot wait until the end of a sprint cycle, create hotfix branch from the <code>master</code> branch:</p>
        <pre class="highlight plaintext"><code>git checkout master&#x000A;git pull&#x000A;git checkout -b &lt;initials&gt;-hotfix-&lt;branch name&gt;&#x000A;</code></pre>
        
        <p>Add your fix and rebase from <code>master</code> regularly to keep up to date. Once your fix is complete, squash your commits into one and submit another pull request. This time, make sure you are merging into the <code>master</code> branch.</p>
        
        <p><em>Your PR should merge INTO <code>master</code> FROM your hotfix branch.</em></p>
        
        <p>Once you&rsquo;ve gotten approval, merge your hotfix branch into the <code>master</code> branch.</p>
        <pre class="highlight plaintext"><code>git checkout master&#x000A;git merge --ff-only &lt;initials&gt;-hotfix-&lt;branch name&gt;&#x000A;</code></pre>
        
        <p>Merge your hotfix branch into development as well.</p>
        <pre class="highlight plaintext"><code>git checkout development&#x000A;git merge --ff-only &lt;initials&gt;-hotfix-&lt;branch name&gt;&#x000A;</code></pre>
        
        <p>Once this is done, delete your branch.</p>
        <pre class="highlight plaintext"><code>git push origin --delete &lt;initials&gt;-hotfix-&lt;branch name&gt;&#x000A;git branch --delete &lt;initials&gt;-hotfix-&lt;branch name&gt;&#x000A;</code></pre>
        
        <h3>Configuration</h3>
        
        <h4>CircleCi</h4>
        
        <p>Here&rsquo;s the basic configuration I use for CircleCI. Make sure you&rsquo;ve got your Heroku API Key &amp; SSH key set up in CircleCI.</p>
        <pre class="highlight yaml"><code><span class="s">deployment</span><span class="pi">:</span>&#x000A;  <span class="s">production</span><span class="pi">:</span>&#x000A;    <span class="s">branch</span><span class="pi">:</span> <span class="s">master</span>&#x000A;    <span class="s">commands</span><span class="pi">:</span>&#x000A;      <span class="pi">-</span> <span class="s">git push git@heroku.com:yourapp.git $CIRCLE_SHA1:master</span>&#x000A;      <span class="pi">-</span> <span class="s">heroku run rake db:migrate --app yourapp</span>&#x000A;      <span class="pi">-</span> <span class="s">heroku run 'rake cache:clear' --app yourapp</span>&#x000A;  <span class="s">staging</span><span class="pi">:</span>&#x000A;    <span class="s">branch</span><span class="pi">:</span> <span class="s">development</span>&#x000A;    <span class="s">commands</span><span class="pi">:</span>&#x000A;      <span class="pi">-</span> <span class="s">git push git@heroku.com:yourapp-staging.git $CIRCLE_SHA1:master</span>&#x000A;      <span class="pi">-</span> <span class="s">heroku run rake db:migrate --app yourapp-staging</span>&#x000A;      <span class="pi">-</span> <span class="s">heroku run 'rake cache:clear' --app yourapp-staging</span>&#x000A;</code></pre>
        
        <p>This will auto-deploy your <code>development</code> branch to staging, and will auto-deploy your <code>master</code> branch to production. For both environments, after deploying, it will auto-run migrations &amp; clear your cache. You can tweak these after-deploy commands to your liking.</p>
        
        <h4>Github</h4>
        
        <p>Set the default branch to be <code>development</code> in the Settings tab of your repository. This makes sure than any pull request will default to merging into the <code>development</code> branch.</p>
        
        <p>Ensure you set both <code>master</code> and <code>development</code> to be protected branches. Make sure that they require passing a CircleCI status check before merging.</p>
        
        <p><hr></p>
        
        <p>That&rsquo;s about it. Got any comments? Questions? <a href="hello@graybike.co">Shoot me an email</a> or <a href="https://twitter.com/ptrikutam">find me on twitter</a>.</p>
      </article>
    </section>
    <footer id='footer'>
      <ul class='text-center'>
        <li>
          <p>
            <a href='mailto:hello@graybike.co'>hello@graybike.co</a>
          </p>
        </li>
        <li class='divider'>
          <p>&#xb7;</p>
        </li>
        <li>
          <p>415.326.3397</p>
        </li>
        <li class='divider'>
          <p>&#xb7;</p>
        </li>
        <li>
          <p>
            <a href='https://twitter.com/ptrikutam'>@ptrikutam</a>
          </p>
        </li>
      </ul>
    </footer>
    <script>
      !function(){var e=document.body,t=(document.documentElement,Math.max(e.offsetHeight,0)),n=Math.max(document.documentElement.clientHeight,window.innerHeight||0),o=document.getElementById("footer");n>t&&(o.style.position="absolute")}();
    </script>
    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      
      ga('create', 'UA-51459213-1', 'graybike.co');
      ga('send', 'pageview');
    </script>
  </body>
</html>
